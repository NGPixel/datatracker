name: Build and Release

on:
  workflow_dispatch:

jobs:

  # -----------------------------------------------------------------
  # TESTS
  # -----------------------------------------------------------------

  tests-playwright:
    name: Run Tests (Playwright)
    runs-on: macos-latest
    strategy:
      fail-fast: false
      matrix:
        project: [chromium, firefox]
    
    steps:
    - uses: actions/checkout@v3

    - uses: actions/setup-node@v2
      with:
        node-version: '18'

    - name: Run all tests
      run: |
        echo "Installing dependencies..."
        yarn
        echo "Installing Playwright..."
        cd playwright
        npm ci
        npx playwright install --with-deps ${{ matrix.project }}
        echo "Running tests..."
        npx playwright test --project=${{ matrix.project }}
        
    - name: Upload Report
      uses: actions/upload-artifact@v3.0.0
      if: ${{ always() }}
      with:
        name: playwright-results-${{ matrix.project }}
        path: playwright/test-results/
